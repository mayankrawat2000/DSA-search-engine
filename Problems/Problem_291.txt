There is a k×kk×k grid, where kk is even. The square in row rr and column cc is denoted by (r,c)(r,c). Two squares (r1,c1)(r1,c1) and (r2,c2)(r2,c2) are considered adjacent if |r1−r2|+|c1−c2|=1|r1−r2|+|c1−c2|=1.
An array of adjacent pairs of squares is called strong if it is possible to cut the grid along grid lines into two connected, congruent pieces so that each pair is part of the same piece. Two pieces are congruent if one can be matched with the other by translation, rotation, and reflection, or a combination of these.
  The picture above represents the first test case. Arrows indicate pairs of squares, and the thick black line represents the cut. 
You are given an array aa of nn pairs of adjacent squares. Find the size of the largest strong subsequence of aa. An array pp is a subsequence of an array qq if pp can be obtained from qq by deletion of several (possibly, zero or all) elements.
